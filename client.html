<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.7.1 at 2016-07-12 
 | Rendered using Apache Maven Fluido Skin 1.5
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20160712" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Soabase &#x2013; </title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.5.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.5.min.js"></script>

                      </head>
        <body class="topBarDisabled">
          
    
    
            
    
        
    <a href="https://github.com/soabase/soabase">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"
        alt="Fork me on GitHub">
    </a>
  
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>Soabase</h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
              
                  <li id="publishDate">Last Published: 2016-07-12
                      <span class="divider">|</span>
                   </li>
                  <li id="projectVersion">Version: 0.10.4-SNAPSHOT
                      </li>
                      
              
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
              
                <ul class="nav nav-list">
                    <li class="nav-header">Soabase</li>
                              
      <li>
  
                          <a href="index.html" title="About">
          <span class="none"></span>
        About</a>
            </li>
                
      <li>
  
                          <a href="usage.html" title="Getting Started">
          <span class="none"></span>
        Getting Started</a>
            </li>
                
      <li>
  
                          <a href="soaconfig.html" title="Configuration">
          <span class="none"></span>
        Configuration</a>
            </li>
                
      <li>
  
                          <a href="example.html" title="Examples">
          <span class="none"></span>
        Examples</a>
            </li>
                              <li class="nav-header">Features</li>
                              
      <li>
  
                          <a href="discovery.html" title="Service Discovery">
          <span class="none"></span>
        Service Discovery</a>
            </li>
                
      <li class="active">
  
            <a href="#"><span class="none"></span>REST Client</a>
          </li>
                
      <li>
  
                          <a href="attributes.html" title="Dynamic Attributes">
          <span class="none"></span>
        Dynamic Attributes</a>
            </li>
                
      <li>
  
                          <a href="deployment-groups.html" title="Deployment Groups">
          <span class="none"></span>
        Deployment Groups</a>
            </li>
                
      <li>
  
                          <a href="admin.html" title="Admin APIs">
          <span class="none"></span>
        Admin APIs</a>
            </li>
                
      <li>
  
                          <a href="console.html" title="Admin Console">
          <span class="none"></span>
        Admin Console</a>
            </li>
                
      <li>
  
                          <a href="config.html" title="Config Utils">
          <span class="none"></span>
        Config Utils</a>
            </li>
                
      <li>
  
                          <a href="guice.html" title="Guice Integration">
          <span class="none"></span>
        Guice Integration</a>
            </li>
                
      <li>
  
                          <a href="launcher.html" title="Launcher Script">
          <span class="none"></span>
        Launcher Script</a>
            </li>
                              <li class="nav-header">Details</li>
                              
      <li>
  
                          <a href="source-repository.html" title="Source Code">
          <span class="none"></span>
        Source Code</a>
            </li>
                
      <li>
  
                          <a href="issue-tracking.html" title="Issues">
          <span class="none"></span>
        Issues</a>
            </li>
                
      <li>
  
                          <a href="apidocs/index.html" title="JavaDoc">
          <span class="none"></span>
        JavaDoc</a>
            </li>
                
      <li>
  
                          <a href="team-list.html" title="Team">
          <span class="none"></span>
        Team</a>
            </li>
                              <li class="nav-header">Reports</li>
                              
      <li>
  
                          <a href="project-summary.html" title="Summary">
          <span class="none"></span>
        Summary</a>
            </li>
                
      <li>
  
                          <a href="dependency-management.html" title="Dependencies">
          <span class="none"></span>
        Dependencies</a>
            </li>
                
      <li>
  
                          <a href="license.html" title="License">
          <span class="none"></span>
        License</a>
            </li>
            </ul>
              
                
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                   
        
        
        
    <iframe src="https://www.facebook.com/plugins/like.php?href=https://github.com/soabase/soabase&send=false&layout=box_count&show-faces=false&action=like&colorscheme=light"
        scrolling="no" frameborder="0"
        style="border:none; width:48px; height:63px; margin-top: 10px;" ></iframe>
               <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span10" >
                                  
            <div class="section">
<h2><a name="REST_Client_Enhancements"></a>REST Client Enhancements</h2>
<p>Soabase augments the standard Dropwizard HttpClient and Jersey Client with a number of features useful in an SOA environment.</p>
<div class="section">
<h3><a name="Service_Discovery_integration_with_retries"></a>Service Discovery integration with retries</h3>
<p>With the REST Client Enhancements, you can call APIs for services and have Service Discovery choose which service instance to use. Simply use the Soabase hostname format for the url passed to the REST client:</p>
<p><tt>//0.service-name/path/to/api</tt></p>
<p>You can also use the utility <tt>ClientUtils.serviceNameToUriForm()</tt>. When the enhanced REST clients see this hostname format, they call <tt>Discovery.getInstance()</tt> using the service name and substituting the returned instance's host and port. If the request needs to be retried (due to errors, etc.) a new instance is retrieved and substituted.</p></div>
<div class="section">
<h3><a name="Request_ID"></a>Request ID</h3>
<p>In an SOA, multiple services are usually involved in handling an end-user request. For tracking and auditing, it's useful to have a way to correlate all of them to the initiating end-user request. Soabase enables this via the Request ID. Via the <tt>ClientFilter</tt> every incoming request is assigned a unique request ID. Further, the REST client enhancements set a header on outgoing requests with this request ID. The <tt>ClientFilter</tt> looks for this header and uses the request ID from it when found.</p><img src="images/request-id.png" alt="" /></div>
<div class="section">
<h3><a name="Usage"></a>Usage</h3>
<p>To use the enhanced REST clients use Soabase's <tt>ClientBuilder</tt>:</p>
<div class="source"><pre class="prettyprint">ClientBuilder builder = new ClientBuilder(environment);
builder.buildJerseyClient(jerseyClientConfig, clientName);  // for Jersey client
builder.buildHttpClient(httpClientConfig, clientName);      // for Apache client</pre></div>
<p>The ClientBuilder registers the clients in Jersey's dependency injection system. E.g.</p>
<div class="source"><pre class="prettyprint">@Path(...)
public class MyResource {
    @Inject
    public MyResource(Client jerseyClient) {
        ...
    }
}</pre></div>
<p>The client can also be accessed from SoaFeatures. E.g.</p>
<div class="source"><pre class="prettyprint">SoaFeatures features = SoaBundle.getFeatures(environment);
Client jerseyClient = features.getNamedRequired(Client.class, clientName);</pre></div></div>
<div class="section">
<h3><a name="Using_a_Different_REST_Client"></a>Using a Different REST Client</h3>
<p>To use a REST client other than Jersey or Apache, use the Soabase client APIs and utility classes to enhance your client. The general form for your code is:</p>
<div class="source"><pre class="prettyprint">// early in your application, create a RetryComponents instance. This is reusable.
ClientBuilder clientBuilder = new ClientBuilder(...);
RetryComponents retryComponents = clientBuilder.getRetryComponents();

// in your method(s) that make REST requests
RequestId.HeaderSetter&lt;REQUEST_TYPE&gt; headerSetter = ... // a functor to set request headers
RequestRunner&lt;REQUEST_TYPE&gt; runner = new RequestRunner&lt;&gt;(retryComponents, headerSetter, requestUri, requestMethod);
while ( requestRunner.shouldContinue() ) {
    URI uri = requestRunner.prepareRequest(request);
    request.setUri(uri);    // substitute the returned URI for your request
    try {
        Response response = ... invoke your request
        if ( requestRunner.isSuccessResponse(response.getStatus()) ) {
            return response;
        }
    } catch ( Exception e ) {
        if ( !requestRunner.shouldBeRetried(e) ) {
            throw e;
        }
    }
}
throw new Exception(&quot;Retries expired: &quot; + requestRunner.getOriginalUri());</pre></div></div></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                                      <p >Copyright &copy;                    2014&#x2013;2016
                        <a href="http://soabase.github.io/">Soabase</a>.
            All rights reserved.    
      </p>
                </div>

        
                </div>
    </footer>
        </body>
</html>
